test_id,priority,module,level,scenario,steps,expected,automation,env_requirements,refs,status,notes
TST-BE-001,P0,bootstrap,build,后端可编译构建,执行 `npm --prefix packages/backend run build`,命令退出码=0；生成 `packages/backend/dist/`,CI/本地脚本,Node>=18,packages/backend/package.json:1,已完成,已在本地验证；建议放入 CI
TST-BE-002,P0,bootstrap,lint,ESLint + Prettier 约束生效,执行 `npm --prefix packages/backend run lint`,命令退出码=0；无 lint error,CI/本地脚本,Node>=18,packages/backend/eslint.config.js:1,已完成,当前 lint 会 --fix，CI 建议改为不自动修复
TST-BE-003,P0,bootstrap,unit,Jest 单元测试可运行,执行 `npm --prefix packages/backend test`,命令退出码=0；测试全绿,Jest,Node>=18,packages/backend/package.json:1,已完成,当前主要为 controller/service 单测（多数无 DB）
TST-BE-004,P1,bootstrap,api,服务可启动并监听 PORT,设置 PORT=3001；执行 `npm --prefix packages/backend run dev`；请求 `GET /api/docs`,控制台显示监听 3001；/api/docs 返回 200（Swagger UI）,手动/可转 E2E,Node>=18；（建议有 PostgreSQL）,packages/backend/src/main.ts:1,未开始,当前 AppModule 启动依赖 DB；无 DB 会失败
TST-BE-005,P0,bootstrap,prod,start:prod 可直接运行 dist,执行 build；再执行 `npm --prefix packages/backend run start:prod`,进程启动并监听 PORT；无运行时异常,手动/可转脚本,Node>=18；（建议 Postgres）,packages/backend/package.json:1,未开始,生产启动依赖 DB；建议补充 /healthz
TST-BE-006,P1,bootstrap,e2e,test:e2e 脚本可运行,执行 `npm --prefix packages/backend run test:e2e`,命令退出码=0；可跑基础 E2E 用例,Jest E2E,Node>=18,packages/backend/package.json:1,已完成,已补齐 jest-e2e.json + hook.e2e-spec.ts；本地执行通过
TST-BE-010,P0,db,integration,TypeORM 连接 PostgreSQL 成功,启动 PostgreSQL；配置 DB_*；执行 `npm --prefix packages/backend run start`,应用启动成功；无 TypeORM 连接错误,可用 docker-compose + CI,PostgreSQL>=13,packages/backend/src/app.module.ts:1,未开始,建议增加 /healthz 并在 CI 做启动探测
TST-BE-011,P1,db,integration,DB 连接失败时的可观测性与退出行为,配置错误 DB_HOST；启动应用,启动失败且日志包含明确错误；进程退出码非 0,手动/可转 CI,PostgreSQL 可选（用于对比）,packages/backend/src/app.module.ts:1,未开始,可考虑统一异常过滤与启动期日志规范
TST-BE-012,P1,db,integration,连接池参数生效（max/idle/connTimeout）,设置 DB_POOL_*；压测并观察连接数/超时,连接数不超过 max；连接超时按配置触发,手动/性能工具,PostgreSQL；压测工具,packages/backend/src/app.module.ts:1,未开始,集群模式下需关注“实例数 x poolMax”
TST-BE-013,P0,db,integration,User.username 唯一约束,插入相同 username 的两条 User,第二次写入失败（唯一约束）,Jest + Postgres,PostgreSQL,packages/backend/src/user/entities/user.entity.ts:1,未开始,
TST-BE-014,P1,db,integration,Webhook / WebhookLog 级联删除（删除 webhook）,创建 webhook + 多条 log；删除 webhook；查询 log 表,对应 log 被级联删除,Jest + Postgres,PostgreSQL,packages/backend/src/webhook-log/entities/webhook-log.entity.ts:1,未开始,
TST-BE-015,P1,db,integration,User / Webhook / WebhookLog 级联删除（删除 user）,创建 user+webhook+log；删除 user；查询 webhook/log 表,webhook/log 被级联删除,Jest + Postgres,PostgreSQL,packages/backend/src/webhook/entities/webhook.entity.ts:1,未开始,当前 Webhook.user onDelete=CASCADE；需验证 DB 实际行为
TST-BE-016,P1,db,integration,时间戳字段自动生成/更新,创建 user/webhook；更新 webhook；检查 createdAt/updatedAt；创建 log 检查 receivedAt,createdAt 初次写入；updatedAt 更新变化；receivedAt 有值,Jest + Postgres,PostgreSQL,packages/backend/src/webhook/entities/webhook.entity.ts:1,未开始,
TST-BE-017,P1,db,integration,JSONB 字段可写可读（config/payload/response/headers）,写入 webhook.config；写入 log.headers/payload/response；读取并比对,JSON 数据结构保持一致,Jest + Postgres,PostgreSQL（jsonb）,packages/backend/src/webhook-log/entities/webhook-log.entity.ts:1,未开始,
TST-BE-018,P2,db,integration,DB_SSL=true 时可连接（受证书策略影响）,配置 DB_SSL=true 且服务端启用 SSL；启动应用,连接成功；无 TLS 相关异常,手动/集成,支持 SSL 的 PostgreSQL,packages/backend/src/app.module.ts:1,未开始,当前 rejectUnauthorized=false；需安全评审
TST-BE-020,P0,auth,api-mock,注册返回 201 且不返回 passwordHash,"POST /api/auth/register {username,password,email}",201；body 含 id/username/email；不含 passwordHash,Jest（已覆盖）,无 DB（mock UserService）,packages/backend/src/auth/auth.controller.spec.ts:1,已完成,建议补充真实 DB 的 API 集成测试
TST-BE-021,P0,auth,unit,注册遇到同名用户返回 409,AuthService.register：mock findByUsername 返回非空,抛出 ConflictException,Jest（已覆盖）,无 DB,packages/backend/src/auth/auth.service.spec.ts:1,已完成,建议补充 controller 层 409 响应断言
TST-BE-022,P0,auth,api-mock,登录成功返回 token（200）,"POST /api/auth/login {username,password}",200；body 含 accessToken 字符串,Jest（已覆盖）,无 DB（mock UserService）,packages/backend/src/auth/auth.controller.spec.ts:1,已完成,
TST-BE-023,P0,auth,api-mock,profile 未携带 JWT 返回 401,GET /api/auth/profile（无 Authorization）,401,Jest（已覆盖）,无 DB,packages/backend/src/auth/auth.controller.spec.ts:1,已完成,
TST-BE-024,P1,auth,api,携带无效 JWT 返回 401,GET /api/auth/profile；Authorization=Bearer invalid,401,可用 supertest/Jest,无 DB,packages/backend/src/auth/jwt.strategy.ts:1,未开始,当前测试未覆盖无效 token 场景
TST-BE-025,P1,auth,api,过期 JWT 返回 401,签发短过期 token；等待过期；请求 profile,401,可用 fake timers,无 DB,packages/backend/src/auth/auth.module.ts:1,未开始,
TST-BE-026,P1,auth,api,DTO 校验：用户名/密码长度不足返回 400,POST /api/auth/register 使用短 username 或短 password,400；错误信息包含字段校验失败,Jest + supertest,无 DB（或 DB）,packages/backend/src/auth/dto/register.dto.ts:1,未开始,建议增加错误响应结构断言
TST-BE-027,P1,auth,api,DTO 校验：email 非法返回 400,POST /api/auth/register email=not-an-email,400,Jest + supertest,无 DB（或 DB）,packages/backend/src/auth/dto/register.dto.ts:1,未开始,
TST-BE-028,P0,webhook,api-mock,未登录访问 /api/webhooks 返回 401,GET /api/webhooks（无 Authorization）,401,Jest（已覆盖）,无 DB（mock WebhookService）,packages/backend/src/webhook/webhook.controller.spec.ts:1,已完成,
TST-BE-029,P0,webhook,api-mock,Webhook CRUD + 分页/筛选基本流程,POST 创建；GET 列表；PATCH 更新；DELETE 删除；GET 筛选 isActive,创建 201；列表 200；更新 200；删除 200；筛选结果正确,Jest（已覆盖，service 为 mock）,无 DB,packages/backend/src/webhook/webhook.controller.spec.ts:1,部分覆盖,需要补充真实 DB 集成测试（unique/path 约束等）
TST-BE-030,P1,webhook,api,创建 webhook：path 非法/超长返回 400,POST /api/webhooks path=包含空格/斜杠 或长度>100,400；校验错误,Jest + supertest,无 DB（或 DB）,packages/backend/src/webhook/dto/create-webhook.dto.ts:1,未开始,
TST-BE-031,P0,webhook,unit,创建 webhook：path 冲突返回 409,WebhookService.create：mock repo.findOne 返回非空,抛出 ConflictException,Jest（已覆盖）,无 DB,packages/backend/src/webhook/webhook.service.spec.ts:1,已完成,
TST-BE-032,P1,webhook,integration,Webhook path 唯一约束（真实 DB）,插入同 path 的两条 webhook,第二次写入失败（唯一约束）,Jest + Postgres 测试库,PostgreSQL,packages/backend/src/webhook/entities/webhook.entity.ts:1,未开始,建议用 docker-compose 在 CI 跑
TST-BE-033,P1,webhook,unit,list 查询：分页/搜索/筛选拼装正确,WebhookService.findAll：传 page/limit/search/isActive,QueryBuilder 链调用参数正确；返回 items/total/page/limit,Jest（已覆盖）,无 DB,packages/backend/src/webhook/webhook.service.spec.ts:1,已完成,
TST-BE-034,P1,webhook,api,列表参数边界：limit>100 返回 400,GET /api/webhooks?limit=101,400,Jest + supertest,无 DB（或 DB）,packages/backend/src/webhook/dto/webhook-list-query.dto.ts:1,未开始,
TST-BE-035,P1,webhook,unit,get 不存在返回 404,WebhookService.findOne：mock qb.getOne 返回 null,抛出 NotFoundException,Jest（已覆盖）,无 DB,packages/backend/src/webhook/webhook.service.spec.ts:1,已完成,
TST-BE-036,P1,webhook,unit,remove 不存在返回 404,WebhookService.remove：mock execute affected=0,抛出 NotFoundException,Jest（已覆盖）,无 DB,packages/backend/src/webhook/webhook.service.spec.ts:1,已完成,
TST-BE-037,P1,hook,api-mock,hook：目标 webhook 不存在返回 404 且不写入日志,GET /hook/missing,404；日志写入次数=0,Jest（已覆盖）,无 DB（mock WebhookService/WebhookLogService）,packages/backend/src/hook/hook.controller.spec.ts:1,已完成,当前实现：只对已存在 webhook 记录日志
TST-BE-038,P0,hook,api-mock,hook：secret 缺失/错误返回 401 并写入日志,POST /hook/demo（无 secret）；POST /hook/demo?secret=bad,401；日志写入次数=1；statusCode=401,Jest（已覆盖）,无 DB,packages/backend/src/hook/hook.controller.spec.ts:1,已完成,注意：401 会暴露 path 是否存在（可在安全评审中决策）
TST-BE-039,P0,hook,api-mock,hook：任意方法成功返回 200 且日志头部脱敏,PUT /hook/demo；header x-webhook-secret=s,200；body={ok:true}；日志 headers[x-webhook-secret]=[redacted],Jest（已覆盖）,无 DB,packages/backend/src/hook/hook.controller.spec.ts:1,已完成,
TST-BE-040,P1,hook,integration,hook：真实 DB 写入 WebhookLog（成功/失败）,创建 webhook+secret；调用 /hook/:path 成功；再调用失败；查询 /api/webhooks/:id/logs,logs 数量与 statusCode/receivedAt 正确；排序正确,Jest + Postgres,PostgreSQL,packages/backend/src/webhook-log/webhook-log.service.ts:1,未开始,建议将日志写入改为异步队列时同步更新用例
TST-BE-041,P1,hook,security,敏感信息不落库：Authorization/Cookie/Secret 头部均脱敏,带上 Authorization/Cookie/x-webhook-secret 请求 hook；查询日志,日志对应 header 为 [redacted]；不含原值,Jest（当前仅覆盖 x-webhook-secret）,无 DB（mock）或 Postgres（真实）,packages/backend/src/hook/hook.controller.ts:1,部分覆盖,建议增加 Authorization/Cookie 的断言
TST-BE-042,P1,hook,api,hook：webhook 未启用（isActive=false）返回 404 且不写 log,将 webhook.isActive 设为 false；请求 /hook/:path,404；不写入 WebhookLog,Jest（mock）/集成（真实 DB）,无 DB 或 PostgreSQL,packages/backend/src/hook/hook.controller.ts:1,未开始,当前逻辑在鉴权前直接 NotFound（不记录日志）
TST-BE-043,P1,hook,integration,hook：payload 记录（JSON 请求体）,POST /hook/:path JSON body；再查询 logs,log.payload 保存并可读,Jest + Postgres,PostgreSQL,packages/backend/src/hook/hook.controller.ts:1,未开始,需确认 content-type 与 body parser 行为
TST-BE-044,P1,hook,security,query 参数 secret 的风险评估与策略,分别使用 header secret 与 query secret 请求；检查日志与网关访问日志,若保留 query secret：需确保不会被上游日志泄露；否则改为仅 header,手动/安全评审,有反向代理/网关更佳,packages/backend/src/hook/hook.controller.ts:1,未开始,query secret 通常不推荐（URL 易泄露）
TST-BE-050,P0,webhook-log,api-mock,未登录访问 logs 返回 401,GET /api/webhooks/:id/logs（无 Authorization）,401,Jest（已覆盖）,无 DB（mock WebhookLogService）,packages/backend/src/webhook-log/webhook-log.controller.spec.ts:1,已完成,
TST-BE-051,P1,webhook-log,api-mock,logs API 返回数组结构,GET /api/webhooks/:id/logs（带 JWT）,200；返回数组；包含 log id,Jest（已覆盖，service 为 mock）,无 DB,packages/backend/src/webhook-log/webhook-log.controller.spec.ts:1,已完成,需要补充真实 DB 的排序/字段完整性验证
TST-BE-052,P1,webhook-log,integration,logs 排序（receivedAt DESC）,插入多条 log（不同时间）；请求 /api/webhooks/:id/logs,返回按 receivedAt 倒序,Jest + Postgres,PostgreSQL,packages/backend/src/webhook-log/webhook-log.service.ts:1,未开始,当前 API 不分页，日志量大时需考虑分页/索引
TST-BE-053,P0,webhook-log,unit,跨用户访问 logs 必须被拒绝,WebhookLogService.listForWebhook：mock webhookService.findOne 抛 NotFound；调用 listForWebhook,抛 NotFoundException；不继续查询 logRepository,Jest,无 DB,packages/backend/src/webhook-log/webhook-log.service.ts:1,未开始,当前实现依赖 webhookService.findOne 做所有权校验
TST-BE-060,P1,swagger,manual,/api/docs 可访问且包含 Auth/Webhook/Logs 文档,启动应用；浏览器访问 /api/docs；检查接口分组与示例,Swagger UI 正常；接口描述/示例可读；hook 不出现在文档,手动/可用 Playwright,可启动 AppModule（通常需 Postgres）,packages/backend/src/main.ts:1,未开始,当前环境受 DB 限制；建议补充 Playwright 快照检查
TST-BE-070,P0,security,security,生产环境禁止使用默认 JWT_SECRET,NODE_ENV=production 且不设置 JWT_SECRET；启动应用,启动失败并提示缺少关键配置,待实现（需增加 env 校验）,Node>=18,packages/backend/src/auth/jwt.strategy.ts:1,未开始,当前代码会回落到 dev_secret（存在风险）
TST-BE-071,P1,security,security,CORS 策略：仅允许白名单 Origin,配置允许域名；分别用允许/不允许 Origin 请求,允许 Origin 返回 CORS header；不允许则无,待实现（需配置 CORS）,Node>=18,packages/backend/src/main.ts:1,未开始,当前 enableCors() 为全开放
TST-BE-072,P1,security,security,Webhook 列表是否返回 secret 的数据最小化策略,创建带 secret 的 webhook；GET /api/webhooks 列表,若策略为不回传 secret：列表不包含 secret；仅创建时可返回一次（需产品确认）,待实现/手动,依赖产品策略；通常需 Postgres,packages/backend/src/webhook/webhook.controller.ts:1,未开始,当前会回传 secret（对 UI/安全有影响）
TST-BE-073,P1,security,security,hook 高并发下写日志的延迟/吞吐评估,对 /hook/:path 压测（并发 50/100）；观察 P95 延迟与 DB 写入,在目标 QPS 下延迟可接受；无明显错误；必要时引入异步队列,k6/artillery,PostgreSQL；压测工具,packages/backend/src/hook/hook.controller.ts:1,未开始,当前实现 await 写日志，会增加响应时间
TST-BE-090,P2,ops,ops,PM2 启动/重载/优雅退出,安装 pm2；build；pm2 start；pm2 reload；观察零停机与退出信号处理,启动成功；reload 不中断；SIGINT/SIGTERM 可优雅退出,手动/可写脚本,pm2；（建议 Postgres）,ecosystem.config.js:1,未开始,当前仓库未内置 pm2；需全局安装
TST-BE-092,P2,ops,ops,PM2 集群实例数与 DB pool 配置协同,instances=max；设置 DB_POOL_MAX；启动并观察 Postgres 连接数,总连接数不超过预期阈值；无连接耗尽,手动/脚本,pm2；PostgreSQL,ecosystem.config.js:1,未开始,需要根据 CPU 与 DB 限额调参
